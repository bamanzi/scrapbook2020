<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
        <title>CentOS下的sudo相关配置的总结归纳_老谭linux集群博客的技术博客_51CTO博客</title>
    <meta name="keywords" content="CentOS下的sudo相关配置的总结归纳,其他博客,51CTO博客">
<meta name="description" content="CentOS下的sudo相关配置的总结归纳，本章记录CentOS下的sudo相关配置的总结归纳">    <meta name="applicable-device" content="pc">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="msvalidate.01" content="91C5324FE68C0A46FA65F3FEC225EA65">
    <link rel="canonical" href="https://blog.51cto.com/cmdschool/1791234">
    <link type="favicon" rel="shortcut icon" href="favicon.ico">
        <script src="about:blank"></script><script src="about:blank"></script><script src="about:blank"></script><script src="about:blank"></script><script type="application/ld+json">/* Code removed by ScrapBook */</script>
        <link href="copybtn.css_v=d1eca929ec" rel="stylesheet">    <script>/* Code removed by ScrapBook */</script>
    <script async="" src="about:blank"></script>
    <script>/* Code removed by ScrapBook */</script>
    <script src="about:blank"></script><script src="about:blank" charset="utf-8"></script><style>
/* Code tidied up by ScrapBook */
</style></head>
<body><div class="Content-box" style="min-height: 575px;"><div class="Content detail-content-new"><div class="clearfix Page" id="page_center" style="position: relative;"><section class="detail-content-left"><article class="common-section common-spacing mb30 article-detail"><!--DOCUMENT_FRAGMENT--><div class="title"><h1>CentOS下的sudo相关配置的总结归纳</h1>
          <span class="tuijian">推荐</span>                        <span class="original">原创</span>
    </div>
    <div class="messbox">
        <p class="clearfix mess-line1">
            <a class="fl" href="https://blog.51cto.com/cmdschool">tanzhenchao</a>
            <time class="fl" pubdate="2016-06-21 09:11:20">2016-06-21 09:11:20</time>
                        <span class="fl">博主文章分类：<a href="https://blog.51cto.com/cmdschool/category10" target="_blank">Other</a></span>
                        </p></div><!--/DOCUMENT_FRAGMENT--><!--DOCUMENT_FRAGMENT--><div class="messbox"><p class="clearfix mess-line1">
        </p>
        <p class="clearfix mess-tag">
                        <strong class="fl">
                <em class="fl">文章标签</em>
                                    <a href="https://blog.51cto.com/topic/sudo.html" class="fl" target="_blank">sudo</a>
                            </strong>
                                    <strong class="fl">
                <em class="fl">文章分类</em>
                                <a href="https://blog.51cto.com/nav/ops1" class="fl" target="_blank">其他</a>
                                <a href="https://blog.51cto.com/nav/ops" class="fl" target="_blank">系统/运维</a>
                            </strong>
                    <strong class="fl"><em class="fl">阅读数</em><b class="fl">4873</b></strong></p>
    </div>
        <div class="copytext" id="copytext">
        ©著作权归作者所有：来自51CTO博客作者tanzhenchao的原创作品，请联系作者获取转载授权，否则将追究法律责任<br><a href="https://blog.51cto.com/cmdschool/1791234">CentOS下的sudo相关配置的总结归纳</a><br><a href="https://blog.51cto.com/cmdschool/1791234">https://blog.51cto.com/cmdschool/1791234</a>    </div>
    <div class="article-content-wrap">
                    <div class="artical-content-bak main-content editor-side-new">
                <div class="con editor-preview-side" id="result"><p><strong style="white-space: normal;"><span style="font-size: 36px;">1 基础部分</span></strong></p><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;">1.1 常用的命令行</span></strong></span></strong></p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_0" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_0"><span class="token function">man</span> sudoers <span class="token comment">#参阅帮助</span>
visudo <span class="token comment">#编辑sudoers的命令</span>
<span class="token function">sudo</span> -l <span class="token comment">#查看可执行或禁止执行的命令</span>
<span class="token function">sudo</span> -u user1 /bin/ls <span class="token comment">#指定user1用户的身份执行命令</span>
<span class="token function">sudo</span> -g gp1 /bin/ls <span class="token comment">#指以gp1组的身份执行</span>
<span class="token function">sudo</span> -u user1 -g gp1 /bin/ls <span class="token comment">#指定用户和组的身份执行</span></code><ul class="pre-numbering" style=""><li>1.</li><li>2.</li><li>3.</li><li>4.</li><li>5.</li><li>6.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;">1.2 配置文件路径</span></strong></span></strong></p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_1" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_1">/etc/sudoers</code><ul class="pre-numbering" style=""><li>1.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;">1.3 sudoers的规则分类</span></strong></span></strong></p><p>sudoers的规则分为以下两类：</p><p>1）别名定义（可选）</p><p>2）授权规则（必选）</p><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;">1.4 特殊符号的用法</span></strong></span></strong></p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_2" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_2"><span class="token string">"#"</span> 用于注释
<span class="token string">"\x"</span> 转义字符
<span class="token string">"<span class="token entity" title="\&quot;">\"</span> 使用到物理行行尾则把下行的物理行连接成一个逻辑行
"</span>*<span class="token string">" 匹配零个或多个字符
"</span>?<span class="token string">" 匹配单个字符
"</span><span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span><span class="token string">" 匹配指定范围的字符
"</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span>" 匹配非指定范围的字符</code><ul class="pre-numbering" style=""><li>1.</li><li>2.</li><li>3.</li><li>4.</li><li>5.</li><li>6.</li><li>7.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p><strong><span style="font-size: 36px;">2 Alias（别名）</span></strong><br></p><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;">2.1 别名的类型</span></strong></span></strong></p><p>包含以下四种别名：User_Alias,Runas_Alias,Host_Alias,Cmnd_Alias</p><p>注：以上别名类型的书写大小写敏感</p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_3" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_3">Alias ::<span class="token operator">=</span> <span class="token string">'User_Alias'</span>  User_Alias <span class="token punctuation">(</span><span class="token string">':'</span> User_Alias<span class="token punctuation">)</span>* <span class="token operator">|</span>
          <span class="token string">'Runas_Alias'</span> Runas_Alias <span class="token punctuation">(</span><span class="token string">':'</span> Runas_Alias<span class="token punctuation">)</span>* <span class="token operator">|</span>
          <span class="token string">'Host_Alias'</span>  Host_Alias <span class="token punctuation">(</span><span class="token string">':'</span> Host_Alias<span class="token punctuation">)</span>* <span class="token operator">|</span>
          <span class="token string">'Cmnd_Alias'</span>  Cmnd_Alias <span class="token punctuation">(</span><span class="token string">':'</span> Cmnd_Alias<span class="token punctuation">)</span>*</code><ul class="pre-numbering" style=""><li>1.</li><li>2.</li><li>3.</li><li>4.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;">2.2 别名的定义格式</span></strong></span></strong><br></p><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;"><strong><span style="font-size: 18px;">2.2.1 单个别名的书写方式</span></strong></span></strong></span></strong></p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_4" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_4">Alias_Type NAME <span class="token operator">=</span> item1, item2, <span class="token punctuation">..</span>.</code><ul class="pre-numbering" style=""><li>1.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p style="white-space: normal;">注：别名成员以“,”号分隔</p><p style="white-space: normal;"><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;"><strong><span style="font-size: 18px;">2.2.2 多个别名的书写方式</span></strong></span></strong></span></strong></p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_5" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_5">Alias_Type NAME <span class="token operator">=</span> item1, item2, item3 <span class="token builtin class-name">:</span> NAME <span class="token operator">=</span> item4, item5</code><ul class="pre-numbering" style=""><li>1.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p style="white-space: normal;">注：以“:”号分隔</p><p style="white-space: normal;"><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;"><strong><span style="font-size: 18px;">2.2.3 四种书写简式</span></strong></span></strong></span></strong></p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_6" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_6">User_Alias ::<span class="token operator">=</span> NAME <span class="token string">'='</span> User_List

Runas_Alias ::<span class="token operator">=</span> NAME <span class="token string">'='</span> Runas_List

Host_Alias ::<span class="token operator">=</span> NAME <span class="token string">'='</span> Host_List

Cmnd_Alias ::<span class="token operator">=</span> NAME <span class="token string">'='</span> Cmnd_List</code><ul class="pre-numbering" style=""><li>1.</li><li>2.</li><li>3.</li><li>4.</li><li>5.</li><li>6.</li><li>7.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p style="white-space: normal;"><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;">2.3 别名定义</span></strong></span></strong><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;"></span></strong></span></strong><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;">NAME的有效字符</span></strong></span></strong></p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_7" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_7">NAME ::<span class="token operator">=</span> <span class="token punctuation">[</span>A-Z<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">[</span>A-Z<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span>_<span class="token punctuation">)</span>*</code><ul class="pre-numbering" style=""><li>1.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;">2.4 常见的定义范例</span></strong></span></strong></p><p><span style="line-height: 0px;"></span></p><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;"><strong><span style="font-size: 18px;">2.4.1 命令行别名的定义范例</span></strong></span></strong></span></strong></p><p>作用：定义用户别名和别名中包含能否运行的命令</p><p>范例：</p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_8" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_8"><span class="token comment">## Networking</span>
Cmnd_Alias NETWORKING <span class="token operator">=</span> /sbin/route, /sbin/ifconfig, /bin/ping, /sbin/dhclient, /usr/bin/net, /sbin/iptables, /usr/bin/rfcomm, /usr/bin/wvdial, /sbin/iwconfig, /sbin/mii-tool</code><ul class="pre-numbering" style=""><li>1.</li><li>2.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;"><strong><span style="font-size: 18px;">2.4.2 用户别名的定义范例</span></strong></span></strong></span></strong></p><p>作用：定义用户别名和别名中包含的用户或组</p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_9" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_9"><span class="token comment">## User Aliases</span>
User_Alias NETWORKINGADMINS <span class="token operator">=</span> user1, user2, %gp1</code><ul class="pre-numbering" style=""><li>1.</li><li>2.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p>注：</p><p>1）组前面加“%”号</p><p>2）用户名必须是系统有效的用户</p><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;"><strong><span style="font-size: 18px;">2.4.3 主机别名的定义范例</span></strong></span></strong></span></strong><br></p><p>作用：定义主机别名和别名中包含的主机</p><p>范例：</p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_10" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_10"><span class="token comment">## Host Aliases</span>
Host_Alias     FILESERVERS <span class="token operator">=</span> fs1, fs2</code><ul class="pre-numbering" style=""><li>1.</li><li>2.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p>注：</p><p>1)服务器fs1和fs2属于FILESERVERS组</p><p>2)主机可以是主机名称、IP(192.168.0.8)、或网段（192.168.0.0/24）、子网掩码(255.255.255.0)</p><p><br></p><p><strong style="white-space: normal;"><span style="font-size: 36px;">3 授权规则</span></strong></p><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;">3.1 授权规则的格式</span></strong></span></strong></p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_11" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_11"><span class="token comment">## Next comes the main part: which users can run what software on</span>
<span class="token comment">## which machines (the sudoers file can be shared between multiple</span>
<span class="token comment">## systems).</span>
<span class="token comment">## Syntax:</span>
<span class="token comment">##</span>
<span class="token comment">##      user    MACHINE=COMMANDS</span>
<span class="token comment">##</span>
<span class="token comment">## The COMMANDS section may have other options added to it.</span>
<span class="token comment">##</span>
<span class="token comment">## Allow root to run any commands anywhere</span></code><ul class="pre-numbering" style=""><li>1.</li><li>2.</li><li>3.</li><li>4.</li><li>5.</li><li>6.</li><li>7.</li><li>8.</li><li>9.</li><li>10.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p>其实就这个意思：</p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_12" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_12">用户名或%组名 可管理的主机名称<span class="token operator">=</span>能否运行的命令</code><ul class="pre-numbering" style=""><li>1.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p>注：以上都可以使用别名代替</p><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;">3.2 授权规则的范例</span></strong></span></strong></p><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;"><strong><span style="font-size: 18px;">3.2.1 不使用别名的定义方式</span></strong></span></strong></span></strong></p><p>基于系统用户名的定义<br></p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_13" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_13">user1 <span class="token assign-left variable">fs1</span><span class="token operator">=</span>/sbin/mount /mnt/cdrom, /sbin/umount /mnt/cdrom</code><ul class="pre-numbering" style=""><li>1.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p>基于系统组的定义</p><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;"><strong><span style="font-size: 18px;"></span></strong></span></strong></span></strong></p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_14" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_14">%gp1 <span class="token assign-left variable">fs1</span><span class="token operator">=</span>/sbin/mount /mnt/cdrom, /sbin/umount /mnt/cdrom</code><ul class="pre-numbering" style=""><li>1.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p>使用ALL关键字的定义</p><p><span style="font-size: 18px;"></span></p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_15" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_15">root    <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span>       ALL</code><ul class="pre-numbering" style=""><li>1.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;"><strong><span style="font-size: 18px;">3.2.2 使用别名的定义方式</span></strong></span></strong></span></strong></p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_16" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_16">NETWORKINGADMINS <span class="token assign-left variable">FILESERVERS</span><span class="token operator">=</span><span class="token punctuation">(</span>NETWORKADMINS<span class="token punctuation">)</span></code><ul class="pre-numbering" style=""><li>1.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p>注：</p><p>1）NETWORKINGADMINS代表定义过的用户或组：user1, user2, %gp1</p><p>2）FILESERVERS代表定义过的服务器：fs1, fs2</p><p>3）NETWORKADMINS代表定义过的命令：/sbin/route, /sbin/ifconfig, /bin/ping, /sbin/dhclient, /usr/bin/net, /sbin/iptables, /usr/bin/rfcomm, /usr/bin/wvdial, /sbin/iwconfig, /sbin/mii-tool</p><p><strong style="white-space: normal;"><span style="font-size: 36px;"></span></strong></p><p style="white-space: normal;"><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;"><strong><span style="font-size: 18px;">3.2.3 关闭密码验证提示</span></strong></span></strong></span></strong></p><p style="white-space: normal;">在命令列前加入关键字“NOPASSWD: ”，详细如下：</p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_17" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_17">%wheel        <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span>       NOPASSWD: ALL</code><ul class="pre-numbering" style=""><li>1.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p>或</p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_18" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_18">%wheel        <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span>       NOPASSWD: /sbin/route</code><ul class="pre-numbering" style=""><li>1.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p><strong style="white-space: normal;"><span style="font-size: 36px;">4 其他指令</span></strong></p><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;">4.1 导入子规则</span></strong></span></strong></p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_19" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_19">includedir /etc/sudoers.d</code><ul class="pre-numbering" style=""><li>1.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p>使定义于/etc/sudoers.d目录下的子规则生效</p><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;">4.2 关闭sudo命令的提示</span></strong></span></strong></p><p style="white-space: normal;">此选项适用于使用shell中调用sudo执行命令时候屏蔽以下提示：</p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_20" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_20">sudo: sorry, you must have a <span class="token function">tty</span> to run <span class="token function">sudo</span></code><ul class="pre-numbering" style=""><li>1.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;"><strong><span style="font-size: 18px;">4.2.1 方法一</span></strong></span></strong></span></strong></p><p>注释掉以下行：</p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_21" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_21"><span class="token comment">#Defaults    requiretty</span></code><ul class="pre-numbering" style=""><li>1.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;"><strong><span style="font-size: 18px;">4.2.2 方法二</span></strong></span></strong></span></strong></p><p style="white-space: normal;">添加以下行：</p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_22" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_22">Defaults:user1 <span class="token operator">!</span>requiretty</code><ul class="pre-numbering" style=""><li>1.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;">4.3 指定安全的执行路径</span></strong></span></strong></p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_23" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_23">Defaults    secure_path <span class="token operator">=</span> /sbin:/bin:/usr/sbin:/usr/bin</code><ul class="pre-numbering" style=""><li>1.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p><strong style="white-space: normal;"><span style="font-size: 36px;">5 开启监视<strong style="white-space: normal;"><span style="font-size: 36px;">日志</span></strong></span></strong></p><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;">5.1 创建日志文件</span></strong></span></strong></p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_24" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_24"><span class="token function">touch</span> /var/log/sudo.log</code><ul class="pre-numbering" style=""><li>1.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p style="white-space: normal;"><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;">5.2 开启sudo的日志功能</span></strong></span></strong></p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_25" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_25">visudo</code><ul class="pre-numbering" style=""><li>1.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p style="white-space: normal;">加入如下行：</p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_26" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_26">Defaults <span class="token assign-left variable">logfile</span><span class="token operator">=</span>/var/log/sudo.log
Defaults <span class="token assign-left variable">loglinelen</span><span class="token operator">=</span><span class="token number">0</span>
Defaults <span class="token operator">!</span>syslog</code><ul class="pre-numbering" style=""><li>1.</li><li>2.</li><li>3.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;">5.3 配置系统日志</span></strong></span></strong></p><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;"><strong><span style="font-size: 18px;">5.3.1 修改日志配置文件</span></strong></span></strong></span></strong></p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_27" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_27"><span class="token function">vim</span> /etc/rsyslog.conf</code><ul class="pre-numbering" style=""><li>1.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p>“local7.*”行后加入如下行：</p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_28" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_28">local2.debug                                            /var/log/sudo.log</code><ul class="pre-numbering" style=""><li>1.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;"><strong><span style="font-size: 18px;">5.3.2 重启系统日志服务</span></strong></span></strong></span></strong></p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_29" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_29"><span class="token function">service</span> rsyslog restart</code><ul class="pre-numbering" style=""><li>1.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;">5.4 测试日志</span></strong></span></strong></p><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;"><strong><span style="font-size: 18px;">5.4.1 命令行监视日志</span></strong></span></strong></span></strong></p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_30" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_30"><span class="token function">tail</span> -f /var/log/sudo.log</code><ul class="pre-numbering" style=""><li>1.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;"><strong><span style="font-size: 18px;">5.4.2 执行指令测试</span></strong></span></strong></span></strong></p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_31" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_31"><span class="token function">sudo</span> /usr/bin/ssh root@127.0.0.1</code><ul class="pre-numbering" style=""><li>1.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p><strong style="white-space: normal;"><span style="font-size: 36px;">6 应用场景</span></strong></p><p><strong><span style="font-size: 36px;"><strong><span style="font-size: 24px;">6.1 排除部分使用的情景</span></strong></span></strong><br></p><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;"><strong><span style="font-size: 18px;">6.1.2 配置要求</span></strong></span></strong></span></strong></p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_32" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_32">禁止某用户使用：su命令
允许某用户使用：su除外命令</code><ul class="pre-numbering" style=""><li>1.</li><li>2.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p>注：禁止的原因是因为用户可以使用此命令提权</p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_33" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_33"><span class="token function">sudo</span> <span class="token function">su</span> - root</code><ul class="pre-numbering" style=""><li>1.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;"><strong><span style="font-size: 18px;">6.1.2 解决方案</span></strong></span></strong></span></strong></p><p>1) 查询用户的所属组</p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_34" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_34"> <span class="token function">id</span> mail</code><ul class="pre-numbering" style=""><li>1.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p><strong style="white-space: normal;"><span style="font-size: 36px;"><strong><span style="font-size: 24px;"></span></strong></span></strong>显示如下：</p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_35" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_35"><span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">(</span>mail<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">(</span>mail<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">(</span>mail<span class="token punctuation">)</span></code><ul class="pre-numbering" style=""><li>1.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p>2) 定义方法</p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_36" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_36">%mail <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> NOPASSWD: ALL
mail <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> NOPASSWD: <span class="token operator">!</span>/bin/su</code><ul class="pre-numbering" style=""><li>1.</li><li>2.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p>注：定义所属组允许执行所有命令，但拒绝用户执行su命令</p><p>3) 相对好的定义方法</p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_37" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_37">%mail <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> NOPASSWD: /sbin/*,/bin/*,/usr/sbin/*,/usr/bin/*
mail <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> NOPASSWD: <span class="token operator">!</span>/bin/su</code><ul class="pre-numbering" style=""><li>1.</li><li>2.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p>可防止用户使用如下方法破解：</p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_38" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_38"><span class="token function">sudo</span> <span class="token function">cp</span> /bin/su assu
<span class="token function">sudo</span> ./assu - root</code><ul class="pre-numbering" style=""><li>1.</li><li>2.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p>4) 相对更好的定义方法</p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_39" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_39">%mail <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> NOPASSWD: /sbin/*,/bin/*,/usr/sbin/*,/usr/bin/*
mail <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> NOPASSWD: <span class="token operator">!</span>/*/* /sbin/*,<span class="token operator">!</span>/*/* /bin/*,<span class="token operator">!</span>/*/* /usr/sbin/*,<span class="token operator">!</span>/*/* /usr/bin/*,<span class="token punctuation">\</span>
                             <span class="token operator">!</span>/bin/su</code><ul class="pre-numbering" style=""><li>1.</li><li>2.</li><li>3.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p>注：禁止用户使用允许的命令操作运行命令的目录的文件</p><p style="white-space: normal;">可防止用户使用如下方法破解：</p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_40" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_40"> <span class="token function">sudo</span> <span class="token function">mv</span> /bin/su /bin/assu
 <span class="token comment">#或者</span>
 <span class="token function">sudo</span> <span class="token function">cp</span> /bin/su /bin/assu
 <span class="token comment">#然后</span>
 <span class="token function">sudo</span> assu - root</code><ul class="pre-numbering" style=""><li>1.</li><li>2.</li><li>3.</li><li>4.</li><li>5.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p>5）实际上，我建议做如下配置</p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_41" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_41">%mail <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> NOPASSWD: /sbin/*,/bin/*,/usr/sbin/*,/usr/bin/*
mail <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> NOPASSWD: <span class="token operator">!</span>/*/* /sbin/*,<span class="token operator">!</span>/*/* /bin/*,<span class="token operator">!</span>/*/* /usr/sbin/*,<span class="token operator">!</span>/*/* /usr/bin/*,<span class="token punctuation">\</span>
                             <span class="token operator">!</span>/bin/su,<span class="token operator">!</span>/usr/bin/passwd *root*,<span class="token operator">!</span>/*/* */root/*</code><ul class="pre-numbering" style=""><li>1.</li><li>2.</li><li>3.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p>可防止用户使用passwd命令操作root用户：</p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_42" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_42"> <span class="token function">sudo</span> <span class="token function">passwd</span> root
 <span class="token function">sudo</span> <span class="token function">passwd</span> -l root
 <span class="token function">sudo</span> <span class="token function">passwd</span> -u root</code><ul class="pre-numbering" style=""><li>1.</li><li>2.</li><li>3.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p>或使用其他命令去操作root的家目录</p><div class="code-toolbar"><div class="hljs-cto"><button data-clipboard-target="#code_id_43" class="copy_btn disable">登录后复制</button><div class="code-toolbar"><pre class="brush:bash;toolbar:false prettyprint language-bash" tabindex="0"><code class=" has-numbering language-bash" id="code_id_43"> <span class="token function">sudo</span> <span class="token function">ls</span> /root/
 <span class="token function">sudo</span> <span class="token function">ls</span> -l /root/</code><ul class="pre-numbering" style=""><li>1.</li><li>2.</li></ul></pre><div class="toolbar"></div></div></div><div class="toolbar"></div></div><p><span style="color: rgb(255, 255, 255); background-color: rgb(255, 0, 0);"><strong>怎样？脑洞大开吧？sudo是相对安全的对吧？O(∩_∩)O哈哈~</strong></span></p><p><span style="color: rgb(255, 255, 255); background-color: rgb(255, 0, 0);"><strong>注：以上个人总结，如有错漏欢迎指正，在下感激不尽。</strong></span></p><p>------------------------------------------------------------</p><p>参阅文献</p><p>官方文档：</p><p><a rel="nofollow" href="https://www.sudo.ws/man/1.8.17/sudoers.man.html" target="_blank"><i class="iconblog bloglink" style="font-size: inherit;"></i>&nbsp;https://www.sudo.ws/man/1.8.17/sudoers.man.html</a></p><p>非官方文档：</p><p><a rel="nofollow" href="http://my.oschina.net/aiguozhe/blog/38706" target="_blank"><i class="iconblog bloglink" style="font-size: inherit;"></i>&nbsp;http://my.oschina.net/aiguozhe/blog/38706</a></p><p><a rel="nofollow" href="http://www.jbxue.com/LINUXjishu/22920.html" target="_blank"><i class="iconblog bloglink" style="font-size: inherit;"></i>&nbsp;http://www.jbxue.com/LINUXjishu/22920.html</a></p><p><a rel="nofollow" href="http://blog.csdn.net/julius819/article/details/7735070" target="_blank"><i class="iconblog bloglink" style="font-size: inherit;"></i>&nbsp;http://blog.csdn.net/julius819/article/details/7735070</a></p><p><a href="http://longcentod.blog.51cto.com/9060910/1533644" target="_blank"><i class="iconblog bloglink" style="font-size: inherit;"></i>&nbsp;http://longcentod.blog.51cto.com/9060910/1533644</a></p><p><a rel="nofollow" href="http://blog.csdn.net/xyz846/article/details/26406955" target="_blank"><i class="iconblog bloglink" style="font-size: inherit;"></i>&nbsp;http://blog.csdn.net/xyz846/article/details/26406955</a></p></div></div></div><!--/DOCUMENT_FRAGMENT--></article></section></div></div></div></body>
</html>

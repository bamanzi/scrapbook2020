<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    
    
    <meta name="language" content="EN">
    <meta name="robots" content="index, follow">
    <meta name="keywords" content="pdo, debian, sw, eng, systemd">
    <meta name="author" content="Enrico Zini">
    <meta name="generator" content="staticsite">
    

    
    <meta property="og:title" content="chroot into arm">
    
    
    <meta property="og:url" content="http://www.enricozini.org/blog/2019/himblick/chroot-into-arm">

    <meta property="og:site_name" content="Enrico Zini">
    
    <meta property="og:type" content="article">
    <meta property="og:article:author" content="Enrico Zini">
    <meta property="og:article:published_time" content="2019-11-28T00:00:00+01:00">
    <meta property="og:article:tag" content="pdo">
    <meta property="og:article:tag" content="debian">
    <meta property="og:article:tag" content="sw">
    <meta property="og:article:tag" content="eng">
    <meta property="og:article:tag" content="systemd">
    
    
    
    

    
    <link href="https://www.enricozini.org/blog/index.rss" rel="alternate" type="application/rss+xml" title="Enrico's blog">
    <link href="https://www.enricozini.org/blog/index.atom" rel="alternate" type="application/atom+xml" title="Enrico's blog">
    
    

    <!-- Bootstrap 4 -->
    <link href="bootstrap.min.css" rel="stylesheet">
    <script src="about:blank"></script>
    <script src="about:blank"></script>
    <script src="about:blank"></script>
    <script src="about:blank"></script>

    <link rel="stylesheet" href="fork-awesome.css">

    <link href="site.css" rel="stylesheet">
    <link href="github.css" rel="stylesheet">

    <link rel="icon" href="favicon.ico">

    <title>chroot into arm</title>

    

    
    
  <style>
/* Code tidied up by ScrapBook */
</style></head>
  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-expand-sm navbar-dark bg-dark mb-3">
      <a class="navbar-brand" href="https://www.enricozini.org/">Enrico Zini</a>

      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
          

          
            <li class="nav-item"><a class="nav-link" href="https://www.enricozini.org/blog">Blog</a></li>
          
            <li class="nav-item"><a class="nav-link" href="https://www.enricozini.org/tags">Tags</a></li>
          
            <li class="nav-item"><a class="nav-link" href="https://www.enricozini.org/series">Series</a></li>
          
            <li class="nav-item"><a class="nav-link" href="https://www.enricozini.org/links">Links</a></li>
          
          


  <li class="nav-item">
    <a class="nav-link" href="https://www.enricozini.org/blog/2019/himblick"><span class="fa fa-backward"></span></a>
  </li>

  
  <li class="nav-item">
    <a class="nav-link" href="https://www.enricozini.org/blog/2019/himblick/raspberry-pi-4-loses-wifi-at-2560x1440-screen-resolution"><span class="fa fa-chevron-left"></span></a>
  
  </li>

  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" href="#" id="nav_series_dropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      Himblick: Raspberry Pi as a digital signage box 6/21
    </a>
      <div class="dropdown-menu" aria-labelledby="nav_series_dropdown">
        
          
            <a class="dropdown-item" href="https://www.enricozini.org/blog/2019/himblick">Himblick: Raspberry Pi as a digital signage box</a>
          
        
          
            <a class="dropdown-item" href="https://www.enricozini.org/blog/2019/himblick/locating-a-sd-card">Locating an SD card</a>
          
        
          
            <a class="dropdown-item" href="https://www.enricozini.org/blog/2019/himblick/write-raspbian-image-to-the-sd-card">Write Raspbian image to the SD card</a>
          
        
          
            <a class="dropdown-item" href="https://www.enricozini.org/blog/2019/himblick/update-sd-image-partitioning">Update SD image partitioning</a>
          
        
          
            <a class="dropdown-item" href="https://www.enricozini.org/blog/2019/himblick/raspberry-pi-4-loses-wifi-at-2560x1440-screen-resolution">Raspberry Pi 4 WiFi stops working at 2560x1440 screen resolution</a>
          
        
          
            <span class="dropdown-item font-weight-bolder">chroot into arm</span>
          
        
          
            <a class="dropdown-item" href="https://www.enricozini.org/blog/2019/himblick/cleanup-raspbian">Cleanup Raspbian</a>
          
        
          
            <a class="dropdown-item" href="https://www.enricozini.org/blog/2019/himblick/ext4-and-32bit-arm-on-64bit-amd64">ext4 and 32bit arm on 64bit amd64</a>
          
        
          
            <a class="dropdown-item" href="https://www.enricozini.org/blog/2019/himblick/running-ansible-in-the-chroot">Running ansible in the chroot</a>
          
        
          
            <a class="dropdown-item" href="https://www.enricozini.org/blog/2019/himblick/himblick-host-setup">himblick host-setup</a>
          
        
          
            <a class="dropdown-item" href="https://www.enricozini.org/blog/2019/himblick/multicast-dns">Multicast DNS</a>
          
        
          
            <a class="dropdown-item" href="https://www.enricozini.org/blog/2019/himblick/ssh-setup">ssh setup</a>
          
        
          
            <a class="dropdown-item" href="https://www.enricozini.org/blog/2019/himblick/x-autologin">X autologin</a>
          
        
          
            <a class="dropdown-item" href="https://www.enricozini.org/blog/2019/himblick/himblick-media-player">himblick media player</a>
          
        
          
            <a class="dropdown-item" href="https://www.enricozini.org/blog/2019/himblick/temporarily-suspending-automount-on-a-device">Temporarily suspending automount on a device</a>
          
        
          
            <a class="dropdown-item" href="https://www.enricozini.org/blog/2019/himblick/read-only-rootfs">Read only rootfs</a>
          
        
          
            <a class="dropdown-item" href="https://www.enricozini.org/blog/2019/himblick/stopping-libreoffice">Stopping libreoffice</a>
          
        
          
            <a class="dropdown-item" href="https://www.enricozini.org/blog/2020/himblick/making-a-frozen-raspbian-repository">Making a frozen raspbian repository</a>
          
        
          
            <a class="dropdown-item" href="https://www.enricozini.org/blog/2020/himblick/creating-a-raspberry-pi-sd-from-tar-files">Creating a Raspberry PI SD from tar files</a>
          
        
          
            <a class="dropdown-item" href="https://www.enricozini.org/blog/2020/himblick/raspberry-pi-4-force-video-mode-at-boot">Raspberry Pi 4: force video mode at boot</a>
          
        
          
            <a class="dropdown-item" href="https://www.enricozini.org/blog/2020/himblick/himblick-one-day-later">Himblick one day later</a>
          
        
      </div>
  </li>

  
  <li class="nav-item">
    <a class="nav-link" href="https://www.enricozini.org/blog/2019/himblick/cleanup-raspbian"><span class="fa fa-chevron-right"></span></a>
  
  </li>

  
  <li class="nav-item">
    <a class="nav-link" href="https://www.enricozini.org/blog/2020/himblick/himblick-one-day-later"><span class="fa fa-forward"></span></a>
  </li>
  



        </ul>
        
        
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="https://www.enricozini.org/blog/index.rss" alt="Enrico's blog" title="Enrico's blog">
            <img src="feed-icon-16x16.png">
          </a>
          </li>
        </ul>
        
        
      </div>
    </nav>

    <div class="container-fluid clearfix" role="main">
    
<div class="d-flex justify-content-between align-items-top mb-4">
  <h1 class="display-4">chroot into arm</h1>
  <div class="text-right">
    
    <a class="badge badge-pill badge-primary" href="https://www.enricozini.org/tags/pdo">pdo</a>
    
    <a class="badge badge-pill badge-primary" href="https://www.enricozini.org/tags/debian">debian</a>
    
    <a class="badge badge-pill badge-primary" href="https://www.enricozini.org/tags/sw">sw</a>
    
    <a class="badge badge-pill badge-primary" href="https://www.enricozini.org/tags/eng">eng</a>
    
    <a class="badge badge-pill badge-primary" href="https://www.enricozini.org/tags/systemd">systemd</a>
    
  </div>
</div>




<p>This is part of a series of posts on the design and technical steps of creating
<a href="https://www.enricozini.org/blog/2019/himblick">Himblick</a>, a digital signage box based on the Raspberry Pi 4.</p>
<p>Now that <a href="https://www.enricozini.org/blog/2019/himblick/update-sd-image-partitioning">we have taken care of updating the SD image partitioning</a>
we are free to customize the system.</p>
<p>Normally one would mount the system partition, chroot into it, and run scripts,
install packages, run ansible playbooks. But this is an arm system, and the
development systems are amd64, which won't run arm binaries. Or won't they?</p>
<p>It turns out that in 2019, <a href="https://wiki.debian.org/QemuUserEmulation">they do</a>:</p>
<div class="codehilite"><pre><span></span><code><span class="err"># apt install qemu binfmt-support qemu-user-static</span>
<span class="err"># chroot /media/root/rootfs</span>
<span class="err">/# /usr/bin/file /usr/bin/file</span>
<span class="err">/usr/bin/file: ELF 32-bit LSB executable, ARM, EABI5 version 1 (SYSV), dynamically linked, …</span>
<span class="err">/# echo foo &gt; /dev/null</span>
<span class="c">bash: /dev/null: Permission denied</span>
</code></pre></div>

<p>Chroot doesn't mount <code>/dev</code>, <code>/sys</code>, <code>/proc</code>, and the rest of the filesystems
needed to run many commands. Now that we live in the future, there's a
straightforward way to get that done, too:</p>
<div class="codehilite"><pre><span></span><code><span class="err"># apt install systemd-container</span>
<span class="err"># systemd-nspawn -D /media/root/rootfs</span>
<span class="err">Spawning container rootfs on /media/enrico/rootfs.</span>
<span class="err">Press ^] three times within 1s to kill container.</span>
<span class="err">~# /usr/bin/file /usr/bin/file</span>
<span class="err">/usr/bin/file: ELF 32-bit LSB executable, ARM, EABI5 version 1 (SYSV), dynamically linked, …</span>
<span class="err">~# echo foo &gt; /dev/null</span>
<span class="err">~# cat /dev/null</span>
<span class="err">~#</span>
</code></pre></div>

<p>So, to recap:</p>
<ol>
<li><code>apt install qemu binfmt-support qemu-user-static systemd-container</code></li>
<li>use <code>systemd-nspawn -D</code> instead of <code>chroot</code></li>
</ol>
<p>and you can chroot in a mostly set up filesystem for any architecture supported
by <a href="https://www.qemu.org/">QEMU</a>.</p>
<p>Joy!</p>
<p><strong>Update</strong>:</p>
<ul>
<li><a href="https://www.enricozini.org/blog/2019/himblick/ext4-and-32bit-arm-on-64bit-amd64">If you do this on ext4, temporarily turn off <code>dir_index</code> optimizations</a></li>
</ul>
<script type="application/json" class="links-metadata">/* Code removed by ScrapBook */</script>




    </div>

    
    <div class="card hidden-print mt-3">
      <div class="card-body">
      
<div class="row">
  <div class="col col-lg-8">
    <small>2019-11-28 00:00</small>
  </div>
  <div class="col-sm-4 text-right">
    
    <a class="badge badge-pill badge-primary" href="https://www.enricozini.org/tags/pdo">pdo</a>
    
    <a class="badge badge-pill badge-primary" href="https://www.enricozini.org/tags/debian">debian</a>
    
    <a class="badge badge-pill badge-primary" href="https://www.enricozini.org/tags/sw">sw</a>
    
    <a class="badge badge-pill badge-primary" href="https://www.enricozini.org/tags/eng">eng</a>
    
    <a class="badge badge-pill badge-primary" href="https://www.enricozini.org/tags/systemd">systemd</a>
    
  </div>
</div>

      <small>© 2019 Enrico Zini.</small>
      <small>Generated with <a href="https://github.com/spanezz/staticsite">staticsite</a> on 2022-03-21 02:00 CET.</small>
      

      </div>
    </div>
    
  
</body><div style="all: initial;"></div>
</html>
